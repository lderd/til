# 이벤트 루프

JavaScript의 런타임 모델은 이벤트 루프에 기반하고 한다. 이러한 이벤트 루프 덕분에 단일 스레드인 JavaScript는 논블록킹 방식으로 작업을 수행할 수 있다.

![event-loop](./assets_이벤트루프/event-loop.png)

## Stack

함수의 호출은 해당 함수의 인수와 지역 변수를 포함하는 각각의 '프레임' 스택을 형성하고 스택에 존재하는 프레임들의 위로 추가된다. 함수가 반환되면 해당 프레임 요소를 스택 밖으로 꺼낸다. 이에 따라 나중에 호출된 함수는 먼저 호출된 함수의 위에 쌓이고 반환되기 때문에 스택의 형태를 띄게 된다.  
여기서 인수와 지역 변수는 스택의 바깥에 저장되기 때문에 중첩 함수에서 지역 변수에 접근할 수 있다.

## Queue

Javascript 런타임은 메시지 큐(Message Queue, 처리할 메시지의 대기열)를 사용한다. Web api에서 비동기 처리 함수의 작업을 진행하고 완료되면 콜백함수를 Queue에 보관한다.
이벤트 루프의 임의의 시점(stack이 빈 시점)에 대기열에서 가장 오래된 메시지(작업이 완료되어 Queue에 들어간지 오래된)를 꺼내서 처리한다. 꺼내진 메시지에 연결된 함수를 호출하여 새로운 스택 프레임을 쌓는다.

## Heap

객체는 힙에 할당된다. 힙은 단순히 메모리의 큰 영역일 뿐이다.

## Event Loop

스택에서 현재 실행중인 작업이 있는지, 큐에 진행 할 작업이 있는지 반복하여 확인하여 스택이 비어있다면 큐에 있는 작업을 스택으로 옮겨 실행한다. 이러한 작업을 반복하기 때문에 Event Loop라는 이름이 붙었다.
