# JSP(현Jakarta Server Pages, 구JavaServer Pages)

jsp파일을 변경하였고 서버에도 내용이 적용되었으나 실제 화면에는 내용이 적용되지 않는다. 이를 해결하기 위해 jsp 파일의 컴파일 과정을 찾아보았다.

## JSP 컴파일

jsp 파일은 서블릿으로 전환된다. 그 과정에서 Java 파일과 SMAP 파일을 생성하고 Java 파일을 컴파일해서 서비스에 이용할 클래스 파일을 생성한다.

![jsp 컴파일과정](./assets_jsp/jsp-processing.jpg)

## deploy 방식에 따른 차이

JSP 파일은 사용 목적이 사용자 뷰에 가깝기 때문에 대부분의 경우 서비스 운영 중에도 수정할 수 있기를 원한다. 따라서 JSP를 사용하는 웹 어플리케이션의 경우 WAR 파일 전체를 리패키징해서 redeploy해야하는 방식보다는 디렉토리 형태로 deploy한다.

- 디렉토리 형태로 deploy한 경우

  해당 디렉토리 아래의 JSP 파일을 수정하면 JSP엔진에서 기존에 컴파일되어있는 클래스 파일의 마지막 수정 시각과 원본 JSP 파일의 수정 시각을 비교해서 컴파일을 수행한다.

- WAR 형태로 deploy한 경우

  war 형태로 deploy한 경우 war 파일 전체를 리패키징해서 redeploy해야 한다. 하지만 jeus에서 graceful redeploy를 제공하기에 이를 고려할 수 있다.

  graceful redeploy : 현재 서비스 중인 어플리케이션의 중단 없이 redeploy한 어플리케이션으로 자연스럽게 서비스를 제공하는 방식. 패키징된 어플리케이션이어야하는 등의 몇가지 조건이 존재한다. 이전 버전을 사용하는 사용자가 존재한다면 이전 버전과 새로운 버전이 모두 deploy된 상태로 서비스를 제공하다가 이전 버전을 사용하는 사용자가 없어지면 이전 버전을 undeploy하는 방식이다. 시간제한을 둬서 일정 시간 이후에는 강제로 이전 버전을 undeploy할 수도 있다. 이를 통해 새로운 어플리케이션으로 변경하더라도 사용자는 끊김 없이 서비스를 이용할 수 있다.

## 결론

JSP파일이 변경되었더라도 변경된 JSP파일을 include하고있는 파일의 수정 시각이 변경되지 않는다면 JSP엔진은 include하고있는 파일을 새로 컴파일하지 않고 기존의 컴파일된 내용으로 서비스 한다. 따라서 수정사항이 적용되지 않은 모습으로 보일 수 있다. 바뀐 JSP파일을 include하고있는 파일들을 찾아서 수정 시각을 변경해주어야 서버에 잘 반영이 된다.

이때, `<check-include-jspfile>` 설정(default false)이 true인 경우 변경되지 않은 jsp파일도 해당 파일이 include한 jsp파일이나 tag파일들을 모두 체크해서 컴파일을 진행한다.

JSP프리컴파일 기능을 사용하지 않는다면 JSP컴파일은 최초 요청 시점에 진행한다. 따라서 최초 요청시 응답시간이 느려질 수 있다.
