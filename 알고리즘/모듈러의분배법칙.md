# 모듈러의 분배법칙

```python
(a + b) % m = ((a % m) + (b % m)) % m
(a - b) % m = ((a % m) - (b % m) + m) % m
(a * b) % m = ((a % m) * (b % m)) % m
```

---

```python
(a / b) % m = ((a % m) / (b % m)) % m  # 는 성립하지 않는다.
'''
(15 // 3) % 7 = 5 % 7 = 5
!=
((15 % 7) // (3 % 7)) % 7 = (1 // 3) % 7 = 0
둘은 확실히 다르다.
'''
```

그럼 이건 어떨까

`(a * b^(-1)) % m = ((a % m) * (b^(-1) % m)) % m` -- 1

이는 정상적인 수식처럼 보인다. 그럼 b의 역수(b의 곱셈에 대한 역원)를 어떻게 구할까.

## 페르마의 소정리

페르마의 소정리에 의하면

`a^(p−1) ≡ 1(mod p), 단 p는 소수이고 a가 p의 배수가 아니다`

와 같은 식이 존재한다. 이에 따르면

`a^(p−1) = a * a^(p−2) ≡ 1(mod p), 단 p는 소수이고 a가 p의 배수가 아니다`

라는 수식이 생기고 이를 위의 1번 식에 적용하면

```
b * b^(m−2) ≡ 1 (mod m)

(a * b^(-1)) % m = ((a % m) * (b^(m-2) % m)) % m
```

따라서

`(a / b) % m = ((a % m) * (b^(m-2) % m)) % m`

가 된다.

## 확장 유클리드 호제법

페르마의 소정리를 이용한 방법은 m이 소수여야만 한다. 하지만 확장 유클리드 호제법은 m이 소수가 아니어도 된다. b와 m이 서로소(공통 소수가 1 뿐인 관계)이기만 하면 된다.

확장 유클리드 호제법은 `a`와 `b`에 대해서 `ax + by = gcd(a, b)`를 만족하는 x, y, gcd(a, b)를 구하는 알고리즘이다.

증명이나 다른 어려운 내용은 넘기고 어떻게 사용하는지 알아보자.

확장 유클리드 호제법은 240과 46을 예시로 들어보면

| index | q             | r                  | a   | b   | s                          | t                          | -                          |
| ----- | ------------- | ------------------ | --- | --- | -------------------------- | -------------------------- | -------------------------- |
| -     | -             | 240                | 240 | 46  | 1                          | 0                          | -                          |
| -     | -             | 46                 | 240 | 46  | 0                          | 1                          | -                          |
| 1     | 240 // 46 = 5 | 240 - 5 \* 46 = 10 | 10  | 46  | 1 - 5 \* 0 = 1             | 0 - 5 \* 1 = -5            | 240 \* 1 + 46 \* -5 = 10   |
| 2     | 46 // 10 = 4  | 46 - 4 \* 10 = 6   | 10  | 6   | 0 - 4 \* 1 = -4            | 1 - 4 \* -5 = 21           | 240 \* -4 + 46 \* 21 = 6   |
| 3     | 10 // 6 = 1   | 10 - 6 \* 1 = 4    | 4   | 6   | 1 - 1 \* -4 = 5            | -5 - 1 \* 21 = -26         | 240 \* 5 + 46 \* -26 = 4   |
| 4     | 6 // 4 = 1    | 6 - 4 \* 1 = 2     | 4   | 2   | -4 - 1 \* 5 = -9           | 21 - 1 \* -26 = 47         | 240 \* -9 + 46 \* 47 = 2   |
| 5     | 4 // 2 = 2    | 4 - 4 \* 2 = 0     | 0   | 2   | 5 - 2 \* -9 = 23           | -26 - 2 \* 47 = -120       | 240 \* 23 + 46 \* -120 = 0 |
| i     | q_i           | r_i                |     |     | s_i-2 - q_i \* s_i-1 = s_i | t_i-2 - q_i \* t_i-1 = t_i | a \* s_i + b \* t_i = r_i  |

index가 4일 때를 보자. gcd(240, 46)인 2를 만드는 x와 y의 값이 -9와 47이라고 나왔다.

`bx - my = gcd(b, m)`

여기서

`240 * -9 + 46 * 47 = 2`

즉 `x = 4` 이다.

이를 어떻게 이용하냐면

```
bx ≡ 1 (mod m)
bx = my + 1
bx - my = 1
b와 m은 서로소이기에
bx - my = gcd(b, m)
```

이렇게 유클리드 호제법을 이용해서 b의 역원인 x를 구해낸다면

`(a / b) % m = ((a % m) * (x % m)) % m`
